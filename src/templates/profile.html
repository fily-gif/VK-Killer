{% extends "base.html" %}
{% load static %}
{% block title %}
{% if profile_user == user %}Ваш профиль{% else %}Профиль {{profile_user}}{% endif %}
{% endblock %}


{% block body %}

<div class="profile-container">
    <div class="navbar">{% include "navbar.html" %}</div>
    <div class="profile-info padd">
        <div class="profile-info-container">
            <div class="nickname"><h3>{{profile_user}}</h3></div>
            <div class="avatar"><img class="avatar" src="{{profile_user.avatar.url}}"></div>
            {% if not profile_user == user and user.is_authenticated %}
                <div class="send-message-button"><a href="/dm/{{profile_user.id}}"><button>Написать сообщение</button></a></div>
                <div class="add-friend-button">
                    {% if not user in offer_accepted_users %}
                        <form method="POST" action="">
                            {% csrf_token %}
                            <button type="submit" name="action" value="add_friend">Добавить в друзья</button>
                        </form>
                        {% if profile_user in offer_accepted_users %}
                            <small>Пользователь подписан на вас</small>
                        {% endif %}
                    {% elif profile_user in offer_accepted_users %}
                        <small>Пользователь у вас в друзьях</small>
                    {% else %}
                        <small>Заявка в друзья отправлена</small>
                    {% endif %}
                </div>
            {% endif %}
            {% if friends %}
                <div class="friends-count"><a class="link-text" href="/friends/{{profile_user.id}}">Друзей: {{friends_count}}</a></div>
                <div class="friends">
                    <table>
                        <tr>
                            {% for fr in friends %}
                                <th><a href="/profile/{{fr.id}}"><img class="avatar small" src="{{fr.avatar.url}}"><br>
                                    <a href="/profile/{{fr.id}}" class="link-text nickname-small">{{fr}}</a></a></th>
                            {% endfor %}
                        </tr>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="posts" style="overflow-y: scroll;" id="posts-box">
        {% for post in posts %}
        <div class="post-container">
            <div class="avatar">
                <img class="avatar small" src="{{post.user.avatar}}">
            </div>
            <div class="image">
                {% if post.image %}<img class="post-image" src="{{post.image.url}}">{% endif %}
            </div>
            <div class="like">
                <form method="POST" action="">
                    {% csrf_token %}
                    <button type="submit" name="action" value="like_{{post.id}}">
                        <img class="like-image" src="{% static 'images/like' %}{% if user in post.likes %}_pressed{% endif %}.png">
                    </button>
                </form>
                <a class="nickname-small">Likes</a> {{ post.likes|length }}
                {% if profile_user == user %}
                <div class="delete-post">
                    <div class="pre-delete">
                        <a class="delete-button"><img class="avatar tiny" src="{% static 'images/cross.png' %}"></a>
                    </div>
                    <div class="delete hide">
                        Удалить<br>пост?
                        <form method="POST" action="">
                            {% csrf_token %}
                            <button type="submit" name="action" value="delete_post_{{post.id}}">
                                <img class="avatar tiny" src="{% static 'images/cross.png' %}">
                            </button>
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="message">
                <a>{{post.message}} </a><a class="timestamp">{{post.time}}</a>
            </div>
        </div>
        <br>
        {% endfor %}
    </div>
    <div class="new-post padd">
        {% if profile_user == user %}
            <img id="preview_image">
            <form method="POST" enctype="multipart/form-data" class="full">
                {% csrf_token %}
                <a>Опубликовать новый пост</a>
                <input type="text" name="message" placeholder="Сообщение">
                <input id="photo_input" type="file" name="image" style="display: none">
                <button type="submit" name="action" value="create_post">Опубликовать</button>
                <label for="photo_input"><img class="avatar small" src="{% static 'images/image.png' %}"><br>Добавить фото (не больше 20МБ)</label>
            </form>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/microblog.js' %}"></script>
{% endblock %}